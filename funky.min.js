(function(e,t){"use strict";var n=e.document;t.getUserMedia=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||naviagor.msGetUserMedia;var r=function(){this.events={};this.container=null;if(!t.getUserMedia){return this.emit("error",{code:r.ERR_COMPATIBILITY})}if(arguments.length===0){return this.emit("error",{code:r.ERR_CONTAINER})}if(arguments.length===1){if(typeof arguments[0]==="string"){this.options={container:arguments[0]}}else{this.options=arguments[0]||{}}}else{this.options={container:arguments[0]};for(var e in arguments[1]){this.options[e]=arguments[1][e]}}if(!this.options.container||n.getElementById(this.options.container)===null){return this.emit("error",{code:r.ERR_CONTAINER})}this.container=n.getElementById(this.options.container);this.init()};r.ERR_OK=0;r.ERR_COMPATIBILITY=1;r.ERR_CONTAINER=2;r.ERR_PERMISSION=3;r.prototype.init=function(){var i=this;this.videoBound={width:0,height:0};this.video=n.createElement("video");this.video.setAttribute("autoplay",true);this.frontCanvas=n.createElement("canvas");this.frontCanvas.style.width="100%";this.frontCanvas.style.height="100%";this.frontCanvas.style.display="none";this.backCanvas=n.createElement("canvas");this.backCanvas.style.display="none";this.back=this.backCanvas.getContext("2d");this.front=this.frontCanvas.getContext("2d");this.container.appendChild(this.video);this.container.appendChild(this.frontCanvas);this.video.addEventListener("play",function(){i.videoBound.width=i.video.clientWidth;i.videoBound.height=i.video.clientHeight;i.video.style.display="none";i.frontCanvas.style.display="block";i.frontCanvas.width=i.videoBound.width;i.frontCanvas.height=i.videoBound.height;i.backCanvas.width=i.videoBound.width;i.backCanvas.height=i.videoBound.height;clearTimeout(i.ticker);i.ticker=setTimeout(function(){i.draw.call(i)},25)},false);t.getUserMedia({video:true,audio:false},function(n){if(t.mozGetUserMedia){i.video.mozSrcObject=n}else{var r=e.URL||e.webkitURL;i.video.src=r.createObjectURL(n)}i.video.play()},function(e){i.emit("error",{code:r.ERR_PERMISSION})})};r.prototype.effectNegative=function(e){if(e){if("-webkit-filter"in this.frontCanvas.style){this.frontCanvas.style["-webkit-filter"]+=" invert(100%)"}else{this.frontCanvas.style["-webkit-filter"]="invert(100%)"}}else{if("-webkit-filter"in this.frontCanvas.style){this.frontCanvas.style["-webkit-filter"]=this.frontCanvas.style["-webkit-filter"].replace(/ ?invert\(\d+%\)/,"")}}};r.prototype.effectVerticalMirror=function(e){var t=function(e,t){var n=e.data,r=this.videoBound.width*4,i=Math.floor(r/2);for(var s=0;s<n.length;s+=4){var o=s-s%r,u=r-s%r,a=o+u;if(u<i)continue;n[a]=n[s];n[a+1]=n[s+1];n[a+2]=n[s+2]}t()};if(e){this.on("draw",t);this._effectVerticalMirror=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectVerticalMirror])}};r.prototype.effectVerticalFlip=function(e){var t=function(e,t){var n=e.data,r=this.videoBound.width*4,i=Math.floor(r/2);for(var s=0;s<n.length;s+=4){var o=s-s%r,u=r-s%r,a=o+u;if(u<i)continue;var f=n[s],l=n[s+1],c=n[s+2];n[s]=n[a];n[s+1]=n[a+1];n[s+2]=n[a+2];n[a]=f;n[a+1]=l;n[a+2]=c}t()};if(e){this.on("draw",t);this._effectVerticalFlip=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectVerticalFlip])}};r.prototype.effectEdgeDetection=function(e){var t=function(e,t){var n=e.data,r=this.videoBound.width*4,i=this.videoBound.height,s=new Uint8ClampedArray(n.length),o=20;for(var u=0;u<n.length;u+=4){var a=Math.round((n[u]+n[u+1]+n[u+2])/3);s[u]=s[u+1]=s[u+2]=a;s[u+3]=0}for(var u=0;u<n.length;u+=4){if(u===0)continue;var f=Math.floor(u/r),l=Math.floor((u-4)/r);if(f!==l)continue;var a=Math.abs(s[u]-s[u-4]);var c=Math.abs(s[u]-(s[u-r]||0));if(a<o&&c<o){n[u]=n[u+1]=n[u+2]=0;continue}n[u]=255;n[u+1]=0;n[u+2]=0}t()};if(e){this.on("draw",t);this._effectEdgeDetection=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectEdgeDetection])}};r.prototype.effectPosterize=function(e){var t=function(e,t){var n=e.data;for(var r=0;r<n.length;r+=4){var i=n[r],s=n[r+1],o=n[r+2];if(i<32)i=15;else if(i>31&&i<64)i=47;else if(i>63&&i<96)i=79;else if(i>95&&i<128)i=111;else if(i>127&&i<160)i=143;else if(i>159&&i<192)i=175;else if(i>191&&i<224)i=207;else if(i>223&&i<256)i=239;if(s<32)s=15;else if(s>31&&s<64)s=47;else if(s>63&&s<96)s=79;else if(s>95&&s<128)s=111;else if(s>127&&s<160)s=143;else if(s>159&&s<192)s=175;else if(s>191&&s<224)s=207;else if(s>223&&s<256)s=239;if(o<32)o=15;else if(o>31&&o<64)o=47;else if(o>63&&o<96)o=79;else if(o>95&&o<128)o=111;else if(o>127&&o<160)o=143;else if(o>159&&o<192)o=175;else if(o>191&&o<224)o=207;else if(o>223&&o<256)o=239;n[r]=i;n[r+1]=s;n[r+2]=o}t()};if(e){this.on("draw",t);this._effectPosterize=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectPosterize])}};r.prototype.effectSepia=function(e){if(e){if("-webkit-filter"in this.frontCanvas.style){this.frontCanvas.style["-webkit-filter"]+=" sepia(100%)"}else{this.frontCanvas.style["-webkit-filter"]="sepia(100%)"}}else{if("-webkit-filter"in this.frontCanvas.style){this.frontCanvas.style["-webkit-filter"]=this.frontCanvas.style["-webkit-filter"].replace(/ ?sepia\(\d+%\)/,"")}}};r.prototype.effectRandomOffset=function(e){var t=function(e,t){var n=e.data,r=this.videoBound.width*4;for(var i=0;i<n.length;i+=4){var s=n[i],o=n[i+1],u=n[i+2];var a=Math.random(),f;if(a<.25)f=i-r;else if(a<.5)f=i+4;else if(a<.75)f=i+r;else f=i-4;if(n[f]!==undefined){n[i]=n[f];n[i+1]=n[f+1];n[i+2]=n[f+2];n[f]=s;n[f+1]=o;n[f+2]=u}}t()};if(e){this.on("draw",t);this._effectRandomOffset=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectRandomOffset])}};r.prototype.effectEdgeDetectionAlt=function(e){var t=function(e,t){var n=e.data,r=this.videoBound.width*4,i=this.videoBound.height,s=[-1,-1,-1,-1,8,-1,-1,-1,-1],o=new Uint8ClampedArray(n.length);for(var u=0;u<n.length;u+=4){var a=Math.round((n[u]+n[u+1]+n[u+2])/3);o[u]=o[u+1]=o[u+2]=a;o[u+3]=0}for(var u=0;u<o.length;u+=4){var f=[o[u-r-4]||0,o[u-r]||0,o[u-r+4]||0,o[u-4]||0,o[u],o[u+4]||0,o[u+r-4]||0,o[u+r]||0,o[u+r+4]||0];var l=r-u%r,c=Math.floor(u/r);if(c===0){f[0]=o[u-r]||0;f[3]=o[u];f[6]=o[u+r]||0}else if(c===i){f[2]=o[u-r]||0;f[5]=o[u];f[8]=o[u+r]||0}if(l===0){f[0]=o[u-4]||0;f[1]=o[u];f[2]=o[u+4]||0}else if(l===r){f[6]=o[u-4]||0;f[7]=o[u];f[8]=o[u+4]||0}if(u===0){f[0]=o[u]}else if(u===r){f[2]=o[u]}else if(c===i&&l===0){f[6]=o[u]}else if(c===i&&l===r){f[8]=o[u]}var h=s[0]*f[0]+s[1]*f[1]+s[2]*f[2]+s[3]*f[3]+s[4]*f[4]+s[5]*f[5]+s[6]*f[6]+s[7]*f[7]+s[8]*f[8];n[u]=n[u+1]=n[u+2]=h}t()};if(e){this.on("draw",t);this._effectEdgeDetectionAlt=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectEdgeDetectionAlt])}};r.prototype.effectScanLines=function(e){var t=function(e,t){var n=e.data,r=this.videoBound.width,i=this.videoBound.height;for(var s=0;s<n.length;s+=4){var o=r-s/4%r;if(o%2===0)continue;n[s]=n[s+1]=n[s+2]=(n[s]+n[s+1]+n[s+2])/3}t()};if(e){this.on("draw",t);this._effectScanLines=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectScanLines])}};r.prototype.effectRgbshifting=function(e){var t=function(e,t){var n=0;var r=0;var i=this.videoBound.width;var s=this.videoBound.height;var o=parseInt(i*1.6/100);var u=e;var a=e.data;var f=new Array;var l=new Array;for(var c=0;c<s;c++){for(var h=0;h<i;h++){var p=(i*c+h)*4;var d=(i*c+(h+o))*4;var v=(i*c+(h+o*-1))*4;f[d]=a[p];f[d+1]=a[p+1];f[d+2]=a[p+2];f[d+3]=a[p+3];l[v]=a[p];l[v+1]=a[p+1];l[v+2]=a[p+2];l[v+3]=a[p+3]}}for(var m=0,g=a.length;m<g;m+=4){if(typeof f[m]!="undefined"){a[m]=f[m];a[m+1]=f[m+1]*.5+a[m+1]*.5;a[m+2]=f[m+2]}if(typeof l[m]!="undefined"){a[m]=l[m]*.5+a[m]*.5;a[m+1]=a[m+1];a[m+2]=l[m+2]}a[m+3]=255}t()};if(e){this.on("draw",t);this._effectRgbshifting=this.events["draw"].length-1}else{this.off("draw",this.events["draw"][this._effectRgbshifting])}};r.prototype.effectDoodle=function(e){var t=this;var n,r;var i=function(){if(!("doodle"in t.processes)){t.frontCanvas.removeEventListener("mousedown",r);t.frontCanvas.removeEventListener("mouseup",n);t.effectDoodleEnabled=false;return true}return false};if(!this.effectDoodleEnabled){this.effectDoodleEnabled=true;r=this.frontCanvas.addEventListener("mousedown",function(e){if(i())return;console.log(t.mousePosition(e))});n=this.frontCanvas.addEventListener("mouseup",function(e){if(i())return;console.log(t.mousePosition(e))})}var s=image.data,o=this.videoBound.width,u=this.videoBound.height;for(var a=0;a<s.length;a+=4){}cb()};r.prototype.mousePosition=function(t){var n=t.target.getBoundingClientRect();var r={x:0,y:0};r.x=t.pageX-n.left-e.scrollX;r.y=t.pageY-n.top-e.scrollY;return r};r.prototype.draw=function(){var e=this;this.back.drawImage(this.video,0,0,this.videoBound.width,this.videoBound.height);var t=this.back.getImageData(0,0,this.videoBound.width,this.videoBound.height);var n="draw"in this.events?this.events["draw"].length:0,r=0,i=function(){r++;if(r<n)return;e.front.putImageData(t,0,0);e.ticker=setTimeout(function(){e.draw.call(e)},25)};if(n===0){return i()}this.emit("draw",t,i)};r.prototype.emit=function(){var e=this;var t=arguments[0],n=Array.prototype.slice.call(arguments,1);if(!(t in this.events))return;this.events[t].forEach(function(t){t.apply(e,n)})};r.prototype.on=function(e,t){if(!(e in this.events)){this.events[e]=[]}this.events[e].push(t)};r.prototype.off=function(e,t){if(!(e in this.events))return;var n=this.events[e].indexOf(t);if(n===-1)return;this.events[e].splice(n,1)};e.funky=r})(window,navigator)