!function(t,e){"use strict";var i=t.document;e.getUserMedia=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||naviagor.msGetUserMedia;var n=function(){if(this.events={},this.container=null,!e.getUserMedia)return this.emit("error",{code:n.ERR_COMPATIBILITY});if(0===arguments.length)return this.emit("error",{code:n.ERR_CONTAINER});if(1===arguments.length)this.options="string"==typeof arguments[0]?{container:arguments[0]}:arguments[0]||{};else{this.options={container:arguments[0]};for(var t in arguments[1])this.options[t]=arguments[1][t]}return this.options.container&&null!==i.getElementById(this.options.container)?(this.container=i.getElementById(this.options.container),this.init(),void 0):this.emit("error",{code:n.ERR_CONTAINER})};n.ERR_OK=0,n.ERR_COMPATIBILITY=1,n.ERR_CONTAINER=2,n.ERR_PERMISSION=3,n.prototype.init=function(){var o=this;this.videoBound={width:0,height:0},this.video=i.createElement("video"),this.video.setAttribute("autoplay",!0),this.frontCanvas=i.createElement("canvas"),this.frontCanvas.style.width="100%",this.frontCanvas.style.height="100%",this.frontCanvas.style.display="none",this.backCanvas=i.createElement("canvas"),this.backCanvas.style.display="none",this.back=this.backCanvas.getContext("2d"),this.front=this.frontCanvas.getContext("2d"),this.container.appendChild(this.video),this.container.appendChild(this.frontCanvas),this.video.addEventListener("play",function(){o.videoBound.width=o.video.clientWidth,o.videoBound.height=o.video.clientHeight,o.video.style.display="none",o.frontCanvas.style.display="block",o.frontCanvas.width=o.videoBound.width,o.frontCanvas.height=o.videoBound.height,o.backCanvas.width=o.videoBound.width,o.backCanvas.height=o.videoBound.height,clearTimeout(o.ticker),o.ticker=setTimeout(function(){o.draw.call(o)},25)},!1),e.getUserMedia({video:!0,audio:!1},function(i){if(e.mozGetUserMedia)o.video.mozSrcObject=i;else{var n=t.URL||t.webkitURL;o.video.src=n.createObjectURL(i)}o.video.play()},function(){o.emit("error",{code:n.ERR_PERMISSION})})},n.prototype.effectNegative=function(t){t?"-webkit-filter"in this.frontCanvas.style?this.frontCanvas.style["-webkit-filter"]+=" invert(100%)":this.frontCanvas.style["-webkit-filter"]="invert(100%)":"-webkit-filter"in this.frontCanvas.style&&(this.frontCanvas.style["-webkit-filter"]=this.frontCanvas.style["-webkit-filter"].replace(/ ?invert\(\d+%\)/,""))},n.prototype.effectVerticalMirror=function(t){var e=function(t,e){for(var i=t.data,n=4*this.videoBound.width,o=Math.floor(n/2),s=0;s<i.length;s+=4){var a=s-s%n,r=n-s%n,h=a+r;o>r||(i[h]=i[s],i[h+1]=i[s+1],i[h+2]=i[s+2])}e()};t?(this.on("draw",e),this._effectVerticalMirror=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectVerticalMirror])},n.prototype.effectVerticalFlip=function(t){var e=function(t,e){for(var i=t.data,n=4*this.videoBound.width,o=Math.floor(n/2),s=0;s<i.length;s+=4){var a=s-s%n,r=n-s%n,h=a+r;if(!(o>r)){var f=i[s],d=i[s+1],v=i[s+2];i[s]=i[h],i[s+1]=i[h+1],i[s+2]=i[h+2],i[h]=f,i[h+1]=d,i[h+2]=v}}e()};t?(this.on("draw",e),this._effectVerticalFlip=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectVerticalFlip])},n.prototype.effectEdgeDetection=function(t){var e=function(t,e){for(var i=t.data,n=4*this.videoBound.width,o=(this.videoBound.height,new Uint8ClampedArray(i.length)),s=20,a=0;a<i.length;a+=4){var r=Math.round((i[a]+i[a+1]+i[a+2])/3);o[a]=o[a+1]=o[a+2]=r,o[a+3]=0}for(var a=0;a<i.length;a+=4)if(0!==a){var h=Math.floor(a/n),f=Math.floor((a-4)/n);if(h===f){var r=Math.abs(o[a]-o[a-4]),d=Math.abs(o[a]-(o[a-n]||0));s>r&&s>d?i[a]=i[a+1]=i[a+2]=0:(i[a]=255,i[a+1]=0,i[a+2]=0)}}e()};t?(this.on("draw",e),this._effectEdgeDetection=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectEdgeDetection])},n.prototype.effectPosterize=function(t){var e=function(t,e){for(var i=t.data,n=0;n<i.length;n+=4){var o=i[n],s=i[n+1],a=i[n+2];32>o?o=15:o>31&&64>o?o=47:o>63&&96>o?o=79:o>95&&128>o?o=111:o>127&&160>o?o=143:o>159&&192>o?o=175:o>191&&224>o?o=207:o>223&&256>o&&(o=239),32>s?s=15:s>31&&64>s?s=47:s>63&&96>s?s=79:s>95&&128>s?s=111:s>127&&160>s?s=143:s>159&&192>s?s=175:s>191&&224>s?s=207:s>223&&256>s&&(s=239),32>a?a=15:a>31&&64>a?a=47:a>63&&96>a?a=79:a>95&&128>a?a=111:a>127&&160>a?a=143:a>159&&192>a?a=175:a>191&&224>a?a=207:a>223&&256>a&&(a=239),i[n]=o,i[n+1]=s,i[n+2]=a}e()};t?(this.on("draw",e),this._effectPosterize=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectPosterize])},n.prototype.effectSepia=function(t){t?"-webkit-filter"in this.frontCanvas.style?this.frontCanvas.style["-webkit-filter"]+=" sepia(100%)":this.frontCanvas.style["-webkit-filter"]="sepia(100%)":"-webkit-filter"in this.frontCanvas.style&&(this.frontCanvas.style["-webkit-filter"]=this.frontCanvas.style["-webkit-filter"].replace(/ ?sepia\(\d+%\)/,""))},n.prototype.effectRandomOffset=function(t){var e=function(t,e){for(var i=t.data,n=4*this.videoBound.width,o=0;o<i.length;o+=4){var s,a=i[o],r=i[o+1],h=i[o+2],f=Math.random();s=.25>f?o-n:.5>f?o+4:.75>f?o+n:o-4,void 0!==i[s]&&(i[o]=i[s],i[o+1]=i[s+1],i[o+2]=i[s+2],i[s]=a,i[s+1]=r,i[s+2]=h)}e()};t?(this.on("draw",e),this._effectRandomOffset=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectRandomOffset])},n.prototype.effectEdgeDetectionAlt=function(t){var e=function(t,e){for(var i=t.data,n=4*this.videoBound.width,o=this.videoBound.height,s=[-1,-1,-1,-1,8,-1,-1,-1,-1],a=new Uint8ClampedArray(i.length),r=0;r<i.length;r+=4){var h=Math.round((i[r]+i[r+1]+i[r+2])/3);a[r]=a[r+1]=a[r+2]=h,a[r+3]=0}for(var r=0;r<a.length;r+=4){var f=[a[r-n-4]||0,a[r-n]||0,a[r-n+4]||0,a[r-4]||0,a[r],a[r+4]||0,a[r+n-4]||0,a[r+n]||0,a[r+n+4]||0],d=n-r%n,v=Math.floor(r/n);0===v?(f[0]=a[r-n]||0,f[3]=a[r],f[6]=a[r+n]||0):v===o&&(f[2]=a[r-n]||0,f[5]=a[r],f[8]=a[r+n]||0),0===d?(f[0]=a[r-4]||0,f[1]=a[r],f[2]=a[r+4]||0):d===n&&(f[6]=a[r-4]||0,f[7]=a[r],f[8]=a[r+4]||0),0===r?f[0]=a[r]:r===n?f[2]=a[r]:v===o&&0===d?f[6]=a[r]:v===o&&d===n&&(f[8]=a[r]);var c=s[0]*f[0]+s[1]*f[1]+s[2]*f[2]+s[3]*f[3]+s[4]*f[4]+s[5]*f[5]+s[6]*f[6]+s[7]*f[7]+s[8]*f[8];i[r]=i[r+1]=i[r+2]=c}e()};t?(this.on("draw",e),this._effectEdgeDetectionAlt=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectEdgeDetectionAlt])},n.prototype.effectScanLines=function(t){var e=function(t,e){var i=t.data,n=this.videoBound.width;this.videoBound.height;for(var o=0;o<i.length;o+=4){var s=n-o/4%n;0!==s%2&&(i[o]=i[o+1]=i[o+2]=(i[o]+i[o+1]+i[o+2])/3)}e()};t?(this.on("draw",e),this._effectScanLines=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectScanLines])},n.prototype.effectRgbshifting=function(t){var e=function(t,e){for(var i=this.videoBound.width,n=this.videoBound.height,o=parseInt(1.6*i/100),s=t.data,a=new Array,r=new Array,h=0;n>h;h++)for(var f=0;i>f;f++){var d=4*(i*h+f),v=4*(i*h+(f+o)),c=4*(i*h+(f+-1*o));a[v]=s[d],a[v+1]=s[d+1],a[v+2]=s[d+2],a[v+3]=s[d+3],r[c]=s[d],r[c+1]=s[d+1],r[c+2]=s[d+2],r[c+3]=s[d+3]}for(var l=0,u=s.length;u>l;l+=4)"undefined"!=typeof a[l]&&(s[l]=a[l],s[l+1]=.5*a[l+1]+.5*s[l+1],s[l+2]=a[l+2]),"undefined"!=typeof r[l]&&(s[l]=.5*r[l]+.5*s[l],s[l+1]=s[l+1],s[l+2]=r[l+2]),s[l+3]=255;e()};t?(this.on("draw",e),this._effectRgbshifting=this.events.draw.length-1):this.off("draw",this.events.draw[this._effectRgbshifting])},n.prototype.effectDoodle=function(){var t,e,i=this,n=function(){return"doodle"in i.processes?!1:(i.frontCanvas.removeEventListener("mousedown",e),i.frontCanvas.removeEventListener("mouseup",t),i.effectDoodleEnabled=!1,!0)};this.effectDoodleEnabled||(this.effectDoodleEnabled=!0,e=this.frontCanvas.addEventListener("mousedown",function(t){n()||console.log(i.mousePosition(t))}),t=this.frontCanvas.addEventListener("mouseup",function(t){n()||console.log(i.mousePosition(t))}));var o=image.data;this.videoBound.width,this.videoBound.height;for(var s=0;s<o.length;s+=4);cb()},n.prototype.mousePosition=function(e){var i=e.target.getBoundingClientRect(),n={x:0,y:0};return n.x=e.pageX-i.left-t.scrollX,n.y=e.pageY-i.top-t.scrollY,n},n.prototype.draw=function(){var t=this;this.back.drawImage(this.video,0,0,this.videoBound.width,this.videoBound.height);var e=this.back.getImageData(0,0,this.videoBound.width,this.videoBound.height),i="draw"in this.events?this.events.draw.length:0,n=0,o=function(){n++,i>n||(t.front.putImageData(e,0,0),t.ticker=setTimeout(function(){t.draw.call(t)},25))};return 0===i?o():(this.emit("draw",e,o),void 0)},n.prototype.emit=function(){var t=this,e=arguments[0],i=Array.prototype.slice.call(arguments,1);e in this.events&&this.events[e].forEach(function(e){e.apply(t,i)})},n.prototype.on=function(t,e){t in this.events||(this.events[t]=[]),this.events[t].push(e)},n.prototype.off=function(t,e){if(t in this.events){var i=this.events[t].indexOf(e);-1!==i&&this.events[t].splice(i,1)}},t.funky=n}(window,navigator);